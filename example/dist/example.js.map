{"version":3,"file":"example.js","sources":["../../src/index.js","../index.js"],"sourcesContent":["// import is from '@meitu/is';\nexport default function matting(options){\n    if(!options.image){\n        console.error('there must be a image contains mask and result.');\n        return;\n    }\n    let image = options.image;\n    let ops = extend({\n        export_quality: .9,\n        export_type : 'base64',   // canvas dom or base64;\n        mask_zoom : 0.5 ,   // 0 < mask_zoom <= 1\n        success(){},\n        error(){},\n    }, options);\n\n    let origin, originCtx, mask, maskCtx, result, resultCtx;\n\n    loadImage(image, imgEl => {\n        // 绘制原图；\n        origin = document.createElement('canvas');\n        originCtx = origin.getContext('2d');\n        origin.width = imgEl.naturalWidth;\n        origin.height = imgEl.naturalHeight / 2;\n        originCtx.drawImage(imgEl, 0, 0);\n\n        // 绘制mask；\n        mask = document.createElement('canvas');\n        maskCtx = mask.getContext('2d');\n        mask.width = imgEl.naturalWidth * ops.mask_zoom;\n        mask.height = imgEl.naturalHeight * ops.mask_zoom / 2;\n        maskCtx.drawImage(imgEl, 0, - imgEl.naturalHeight * ops.mask_zoom / 2, imgEl.naturalWidth * ops.mask_zoom , imgEl.naturalHeight * ops.mask_zoom);\n\n        // 去除mask图黑色背景；\n        let maskData = maskCtx.getImageData(0, 0, mask.width, mask.height);\n        filter(maskData.data);\n        maskCtx.putImageData(maskData, 0, 0);\n\n        result = document.createElement('canvas');\n        resultCtx = result.getContext('2d');\n        result.width = imgEl.naturalWidth;\n        result.height = imgEl.naturalHeight / 2;\n\n        resultCtx.drawImage(mask, 0, 0, imgEl.naturalWidth, imgEl.naturalHeight / 2);\n\n        resultCtx.globalCompositeOperation = 'source-in';\n\n        resultCtx.drawImage(origin, 0, 0);\n\n        if(ops.export_type == 'canvas'){\n            ops.success(result);\n        }else{\n            ops.success(result.toDataURL(`image/png`, ops.quality));\n        }\n    }, err => {\n        ops.error(err);\n    });\n}\n\nfunction loadImage(image, cbk, error){\n    if(typeof image == 'string'){\n        let img = new Image();\n        img.crossOrigin = '*';\n        img.onload = () => {\n            cbk(img);\n        };\n        img.onerror = () => {\n            console.error('load image error!');\n            error(image);\n        };\n        img.src = image + `?${new Date().getTime()}`;\n    }else{\n        cbk(image);\n    }\n}\nfunction filter(data) {\n    for (let i = 0; i < data.length; i += 4) {\n        let r = data[i],\n            g = data[i + 1],\n            b = data[i + 2];\n\n        if (r <= 30 && g <= 30 && b<= 30) {\n            data[i + 3] = 0;\n        }\n    }\n}\nfunction extend(obj1, obj2) {\n    for (let k in obj2) {\n        if (obj2.hasOwnProperty(k)) {\n            if (typeof obj2[k] == 'object') {\n                if (typeof obj1[k] !== 'object' || obj1[k] === null) {\n                    obj1[k] = {};\n                }\n                extend(obj1[k], obj2[k]);\n            } else {\n                obj1[k] = obj2[k];\n            }\n        }\n    }\n    return obj1;\n}\n","import matting from '../src/index';\n\nwindow.onload = function(){\n    let $btn = document.getElementById('btn');\n    let $origin = document.getElementById('origin');\n    let $result = document.getElementById('result');\n    $btn.addEventListener('click',function(){\n        matting({\n            image: $origin,\n            export_quality: .9,\n            export_type : 'base64',   // canvas dom or base64;\n            mask_zoom : 0.5 ,\n            success(result){\n                // canvas.className = 'image';\n                let img = document.createElement('img');\n                img.className = 'image';\n                img.src = result;\n\n                $result.appendChild(img);\n            },\n        });\n    });\n};\n"],"names":["matting","options","image","error","ops","extend","origin","originCtx","mask","maskCtx","result","resultCtx","document","createElement","getContext","width","imgEl","naturalWidth","height","naturalHeight","drawImage","mask_zoom","maskData","getImageData","data","putImageData","globalCompositeOperation","export_type","success","toDataURL","quality","err","loadImage","cbk","img","Image","crossOrigin","onload","onerror","src","Date","getTime","filter","i","length","r","g","b","obj1","obj2","k","hasOwnProperty","window","$btn","getElementById","$origin","$result","addEventListener","className","appendChild"],"mappings":"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"}